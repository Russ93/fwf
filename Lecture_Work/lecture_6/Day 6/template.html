<!DOCTYPE html>
<html lang="en" ng-app="inv">
    <head>
        <meta charset="utf-8">
        <title>Day 6 Practice</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.2/angular.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.2/angular-resource.js"></script>
    </head>
    <body>
        <h1><a href="#/index">Home</a></a></h1>
        <a href="#/add">Add Item</a>
        
        <script>
            iapp = angular.module('inv',['ngResource']);
            
            iapp.config(function($routeProvider) {
                $routeProvider
                .when('/index',{
                    controller:'homectrl',
                    templateUrl:'views/index.html'
                })
                .when('/add',{
                    controller:'homectrl',
                    templateUrl:'views/add.html'
                })
                .when('/delete/:id',{
                    controller:'homectrl',
                    templateUrl:'views/delete.html'
                })
                .when('/edit/:id',{
                    controller:'homectrl',
                    templateUrl:'views/edit.html'
                })
                .otherwise({
                    redirectTo:'/index'
                })
            })
            
            iapp.run(function($rootScope,itemData) {
                itemData.get(function(response) {
                    $rootScope.data = response.inventory;
                })
            })
            
            iapp.factory('itemData', function($resource) {
                return $resource('data.json',{});
            })
            
            iapp.controller('homectrl', function($scope,$rootScope,$location,$routeParams) {
                myurl = document.URL.split("http://127.0.0.1:59350/template.html#/");
                myurlaction = myurl[1].split("/");
                action = myurlaction[0];
                
                if(action=="index") {
                    $scope.items = $rootScope.data;
                } else if(action=="add") {
                    $scope.item = {};
                    $scope.add = function() {
                        $rootScope.data.push($scope.item);
                        $location.url('/index');
                    } 
                } else if(action=="delete") {
                    $scope.del = function() {
                        $rootScope.data.splice($routeParams.id, 1);
                        $location.url('/index');
                    }  
                } else if(action=="edit") {
                    $scope.item = $rootScope.data[$routeParams.id];
                    $scope.update = function() {
                        $rootScope.data[$routeParams.id] = $scope.item;
                        $location.url('/index');
                    }  
                }
            })
        </script>
        <div ng-view></div>
    </body>
</html>